## 第13章 工厂方法（Factory Method）模式

<p>工厂方法模式是类的创建模式，又叫做虚拟构造子(Virtual Constructor)模式，或者多态性工厂(Polymorphic Factory)模式。</p>

<pre>
polymorphic
美 [ˌpɑˌliˈmɔrfɪk]  
n. 多态;多型;多态性;
adj. 多形的;多态的
</pre>

<p>工厂方法模式的用意是定义一个创建产品对象的工厂接口，将实际创建工作推迟到子类中。</p>

### 13.1 引言

#### 13.1.1 简单工厂模式的优缺点

<p>正如本书在“简单工厂(Simple Factory)模式”一章里介绍过的，工厂模式哟简单工厂模式、工厂方法模式和抽象工厂模式几种。</p>
<p>在简单工厂模式中，一个工厂类处于对产品类实例化的中心位置上，他知道每一个产品，它决定哪一个产品类应当被实例化。</p>
<p>这个模式的有点是允许客户端相对独立于产品的创建过程，并且在系统引入新产品的时候无需修改客户端，也就是说，它在某种程度上支持“开-闭”原则。</p>
<p>这个模式的缺点是对“开-闭”原则的支持不够，因为如果有新的产品加入到系统中去，就需要修改工厂类，将必要的逻辑加入到工厂类中。</p>

#### 13.1.2 工厂方法模式的引进

<p>本章要讨论的工厂方法模式是简单工厂模式的进一步抽象和推广。由于使用了多态性，工厂方法模式保持了简单工厂模式的优点，并且克服了它的缺点。</p>
<p>首先，在工厂方法模式中，核心的工厂类不再负责所有产品的创建，而是将具体创建的工作交给子类去做。这个核心类摇身一变，成为了一个抽象工厂角色，仅负责给出具体工厂子类必须实现的接口，而不接触哪一个产品类应当被实例化这种细节。</p>
<p>这种进一步抽象化的结果，使这种工厂方法模式可以用来允许系统在不修改具体工厂角色的情况下引进新的产品，这一特点无疑使得工厂模式具有超过简单工厂模式的优越性。</p>
<p>下图所示是工厂方法模式的简略类图，此类图中仅展示了一个工厂类和一个产品类，在实际系统里，会遇到多个产品类及相应的工厂类。</p>

<img src="./image/13.01.001.svg"/>

#### 13.1.3 平行的等级结构

<p>在一个系统设计中，常常是先有产品角色，再有工厂角色。在一个可以应用工厂方法模式的场景下，一般都会有一个产品的等级结构，有一个甚至多个抽象产品和多个具体产品组成。产品等级结构如下：</p>

<img src="./image/13.01.002.svg"/>

<p>这里出现了多余一个的抽象产品类，和多余两个的层次。这其实是真实系统中经常出现的情况。当把工厂方法模式应用到此系统时，常采用一个做法是按照产品的等级结构设计一个同结构的工厂等级结构。如下：</p>

<img src="./image/13.01.003.svg"/>

<p>然后由相应的工厂角色创建相应的产品角色。应用如下图所示，虚线代表创建关系：</p>

<img src="./image/13.01.004.svg"/>

<p>工厂方法模式并没有限制产品等级结构的层数。一般资料介绍都以两个层次为例，第一层是抽象产品层，第二层是具体产品层。但在实际系统中，产品常有更为复杂的层次。</p>

### 13.2 工厂方法模式的结构

#### 13.2.1 结构与角色

<p>为了说明工厂方法模式的结构，下面是一个最简单的情形示例，这个示例性系统的类图如下：</p>

<img src="./image/13.02.001.svg"/>

<p>从上图可看出，这个使用了工厂方法模式的系统涉及到以下角色：</p>

* 抽象工厂(Creator)角色

<p>这个角色是工厂方法模式的核心，与应用程序逻辑无关。在模式中创建对象的工厂类必须实现这个接口。在上面的系统中，这个角色又Java接口(Creator)扮演；在实际系统中，这个角色常使用抽象Java类实现。</p>

* 具体工厂(Concrete Creator)角色

<p>担任这个角色的是实现了抽象工厂接口的具体Java类。具体工厂角色含有与应用密切相关的逻辑，并且受到应用程序的调用以创建产品对象。</p>

* 抽象产品(Product)角色

<p>工厂方法模式所创建的对象的超类型，也就是产品对象的共同父类或者共同拥有的接口。本系统中由Java接口Product扮演；实际系统中，这个角色常用抽象Java类实现。</p>

* 具体产品(Concrete Product)角色

<p>这个角色实现了抽象产品角色所声明的接口。工厂方法模式所创建的每一个对象都是某个具体产品角色的实例。</p>

- - -

<p>最后，为了说明这个胸痛的使用方法，特地引进了一个客户端角色Client。这个角色创建工厂对象，然后调用工厂对象的工厂方法创建相应的产品对象。</p>

#### 13.2.2 源代码

<p>下面是这个示意性系统的源代码。</p>

* 具代码吗清单1：抽象工厂角色Creator类的源代码

```Java
pa
```

<p></p>
<p></p>
<p></p>
<p></p>

#### 13.2.3 工厂方法模式的活动序列图

<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

#### 13.2.4 工厂方法模式和简单工厂模式


<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

### 13.3 工厂方法模式在农场系统中的实现

<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

### 13.4 关于工厂方法模式的实现

<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

### 13.5 Java语言中工厂方法模式的例子

<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

### 13.6 工厂方法模式与其他模式的关系

<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

### 13.7 女娲举绳造人

<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

### 13.8 其他的例子

<p></p>
<p></p>
<p></p>
<p></p>
<p></p>


